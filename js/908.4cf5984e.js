"use strict";(globalThis["webpackChunkdo_it"]=globalThis["webpackChunkdo_it"]||[]).push([[908],{9908:(e,a,t)=>{t.r(a),t.d(a,{default:()=>q});var i=t(1758),l=t(8790);const n={class:"q-gutter-md"};function o(e,a,t,o,s,d){const r=(0,i.g2)("q-card"),m=(0,i.g2)("q-td"),u=(0,i.g2)("q-btn"),g=(0,i.g2)("q-spinner-dots"),c=(0,i.g2)("q-inner-loading"),p=(0,i.g2)("q-table"),b=(0,i.g2)("q-page"),h=(0,i.g2)("q-input"),f=(0,i.g2)("q-select"),k=(0,i.g2)("q-card-section"),F=(0,i.g2)("q-card-actions"),v=(0,i.g2)("q-dialog"),_=(0,i.gN)("close-popup");return(0,i.uX)(),(0,i.CE)(i.FK,null,[a[11]||(a[11]=(0,i.Lk)("link",{rel:"stylesheet",href:"https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css"},null,-1)),(0,i.bF)(b,{class:"q-pa-md bg-white"},{default:(0,i.k6)((()=>[(0,i.Lk)("div",null,[(0,i.bF)(r,{class:"q-pa-md no-shadow q-mb-md cardd",bordered:""},{default:(0,i.k6)((()=>a[9]||(a[9]=[(0,i.Lk)("p",{class:"text-weight-bold texttitle text text-h6 text-black"}," All Users ",-1),(0,i.Lk)("p",{class:"text-weight-bold text-caption text-grey-5 text"}," View and manage all registered users from this section. ",-1)]))),_:1}),(0,i.Lk)("div",null,[(0,i.bF)(r,{class:"q-pa-md no-shadow q-mb-md cardd",bordered:""},{default:(0,i.k6)((()=>[(0,i.bF)(p,{title:"Daftar Pengguna",rows:s.pengguna,columns:s.columns,"row-key":"id",flat:"",bordered:"",dense:""},{"body-cell-created_at":(0,i.k6)((e=>[(0,i.bF)(m,{props:e},{default:(0,i.k6)((()=>[(0,i.eW)((0,l.v_)(d.formatToWIB(e.row.created_at)),1)])),_:2},1032,["props"])])),"body-cell-uid_rfid":(0,i.k6)((e=>[(0,i.bF)(m,{props:e},{default:(0,i.k6)((()=>a[10]||(a[10]=[(0,i.eW)(" ***** ")]))),_:2},1032,["props"])])),"body-cell-aksi":(0,i.k6)((a=>[(0,i.bF)(m,{align:"center"},{default:(0,i.k6)((()=>[(0,i.bF)(u,{color:"primary",icon:"edit",dense:"",flat:"",round:"",onClick:e=>d.editPengguna(a.row)},null,8,["onClick"]),(0,i.bF)(u,{color:"negative",icon:"delete",dense:"",flat:"",round:"",onClick:t=>e.deletePengguna(a.row.id)},null,8,["onClick"])])),_:2},1024)])),loading:(0,i.k6)((()=>[(0,i.bF)(c,{showing:"",color:"primary"},{default:(0,i.k6)((()=>[(0,i.bF)(g,{size:"40px",color:"primary"})])),_:1})])),_:1},8,["rows","columns"])])),_:1})])])])),_:1}),(0,i.bF)(v,{modelValue:s.editDialog,"onUpdate:modelValue":a[8]||(a[8]=e=>s.editDialog=e)},{default:(0,i.k6)((()=>[(0,i.bF)(r,null,{default:(0,i.k6)((()=>[(0,i.bF)(k,null,{default:(0,i.k6)((()=>[(0,i.Lk)("div",n,[(0,i.bF)(h,{modelValue:s.editForm.uid_rfid,"onUpdate:modelValue":a[0]||(a[0]=e=>s.editForm.uid_rfid=e),label:"UID RFID"},null,8,["modelValue"]),(0,i.bF)(h,{modelValue:s.editForm.nama,"onUpdate:modelValue":a[1]||(a[1]=e=>s.editForm.nama=e),label:"Nama"},null,8,["modelValue"]),(0,i.bF)(h,{modelValue:s.editForm.npm,"onUpdate:modelValue":a[2]||(a[2]=e=>s.editForm.npm=e),label:"NPM"},null,8,["modelValue"]),(0,i.bF)(h,{modelValue:s.editForm.jabatan,"onUpdate:modelValue":a[3]||(a[3]=e=>s.editForm.jabatan=e),label:"Jabatan"},null,8,["modelValue"]),(0,i.bF)(h,{modelValue:s.editForm.username,"onUpdate:modelValue":a[4]||(a[4]=e=>s.editForm.username=e),label:"Username"},null,8,["modelValue"]),(0,i.bF)(h,{modelValue:s.editForm.password,"onUpdate:modelValue":a[5]||(a[5]=e=>s.editForm.password=e),label:"Password",type:"password",autocomplete:"new-password",hint:"Kosongkan jika tidak diubah"},null,8,["modelValue"]),(0,i.bF)(f,{modelValue:s.editForm.device_id,"onUpdate:modelValue":a[6]||(a[6]=e=>s.editForm.device_id=e),options:s.deviceOptions,label:"Device","option-label":"nama_device","option-value":"id","emit-value":"","map-options":"",clearable:"",dense:""},null,8,["modelValue","options"]),(0,i.bF)(f,{modelValue:s.editForm.instansi_id,"onUpdate:modelValue":a[7]||(a[7]=e=>s.editForm.instansi_id=e),options:s.instansiOptions,label:"Instansi","option-label":"nama_instansi","option-value":"id","emit-value":"","map-options":"",clearable:"",dense:""},null,8,["modelValue","options"])])])),_:1}),(0,i.bF)(F,{align:"right"},{default:(0,i.k6)((()=>[(0,i.bo)((0,i.bF)(u,{flat:"",label:"Batal"},null,512),[[_]]),(0,i.bF)(u,{color:"primary",label:"Simpan",onClick:d.submitEdit},null,8,["onClick"])])),_:1})])),_:1})])),_:1},8,["modelValue"])],64)}var s=t(2303);const d={data(){return{loggedInUserId:null,editForm:{id:null,uid_rfid:"",nama:"",npm:"",jabatan:"",username:"",password:"",device_id:null,instansi_id:null},deviceOptions:[],instansiOptions:[],loading:!1,editDialog:!1,intervalId:null,pengguna:[],columns:[{name:"id",label:"ID",field:"id",align:"left",sortable:!0},{name:"uid_rfid",label:"UID RFID",field:"uid_rfid",align:"left",sortable:!0},{name:"nama",label:"Nama",field:"nama",align:"left",sortable:!0},{name:"username",label:"Nama",field:"username",align:"left",sortable:!0},{name:"npm",label:"NPM",field:"npm",align:"left",sortable:!0},{name:"jabatan",label:"Jabatan",field:"jabatan",align:"left",sortable:!0},{name:"nama_device",label:"Nama device",field:"nama_device",align:"left",sortable:!0},{name:"nama_instansi",label:"Nama instansi",field:"nama_instansi",align:"left",sortable:!0},{name:"created_at",label:"Didaftarkan",field:"created_at",align:"left",sortable:!0},{name:"aksi",label:"Aksi",align:"center"}]}},methods:{async fetchPengguna(){try{const e=localStorage.getItem("token"),a=await this.$api.get("pengguna",{headers:{Authorization:`Bearer ${e}`}});this.pengguna=a.data,console.log(this.pengguna)}catch(e){this.$q.notify({type:"negative",message:"Gagal load pengguna"})}},formatToWIB(e){return new Date(e).toLocaleString("id-ID",{timeZone:"Asia/Jakarta"})},editPengguna(e){this.editForm={...e},this.editDialog=!0},async submitEdit(){try{const e=localStorage.getItem("token"),a={...this.editForm};a.password||delete a.password,await this.$api.put(`/pengguna/${a.id}`,a,{headers:{Authorization:`Bearer ${e}`}}),this.$q.notify({type:"positive",message:"Data pengguna berhasil diupdate!"}),this.editDialog=!1,await this.fetchPengguna()}catch(e){console.error("Gagal update pengguna:",e.response||e),this.$q.notify({type:"negative",message:"Gagal update data pengguna: "+(e.response?.data?.message||e.message),position:"top-right"})}},async deleteUser(e){this.$q.dialog({title:"Konfirmasi",message:"Yakin ingin menghapus user ini?",cancel:!0,persistent:!0}).onOk((async()=>{try{const a=localStorage.getItem("token");await this.$api.delete(`users/${e}`,{headers:{Authorization:`Bearer ${a}`}}),this.$q.notify({type:"positive",message:"User berhasil dihapus."}),this.fetchUsers()}catch(e){this.$q.notify({type:"negative",message:"Gagal menghapus user."})}}))},async fetchDeviceOptions(){try{const e=localStorage.getItem("token"),a=await this.$api.get("/device",{headers:{Authorization:`Bearer ${e}`}});this.deviceOptions=a.data}catch(e){console.error("Gagal ambil daftar device:",e)}},async fetchInstansiOptions(){try{const e=localStorage.getItem("token"),a=await this.$api.get("/instansi",{headers:{Authorization:`Bearer ${e}`}});this.instansiOptions=a.data}catch(e){console.error("Gagal ambil daftar instansi:",e)}},editUser(e){this.form={...e,password:""},this.editDialog=!0},async updateUser(){try{const e=localStorage.getItem("token");await s.A.put(`http://localhost:5000/users/${this.form.id_user}`,{name:this.form.name,email:this.form.email,password:this.form.password||void 0,role:this.form.role},{headers:{Authorization:`Bearer ${e}`}}),this.$q.notify({type:"positive",message:"User berhasil diperbarui."}),this.editDialog=!1,this.fetchUsers()}catch(e){this.$q.notify({type:"negative",message:"Gagal memperbarui user."})}}},mounted(){this.fetchPengguna(),this.fetchDeviceOptions(),this.fetchInstansiOptions();const e=JSON.parse(localStorage.getItem("user"));this.intervalId=setInterval(this.fetchPengguna,2e3),this.loggedInUserId=e?e.id_user:null},beforeUnmount(){clearInterval(this.intervalId)},computed:{user(){return JSON.parse(localStorage.getItem("user"))||{}}}};var r=t(2807),m=t(7716),u=t(3316),g=t(528),c=t(5262),p=t(1693),b=t(9035),h=t(9198),f=t(2156),k=t(4189),F=t(9270),v=t(8005),_=t(2669),y=t(8672),w=t(8582),I=t.n(w);const V=(0,r.A)(d,[["render",o]]),q=V;I()(d,"components",{QPage:m.A,QCard:u.A,QTable:g.A,QTd:c.A,QBtn:p.A,QInnerLoading:b.A,QSpinnerDots:h.A,QDialog:f.A,QCardSection:k.A,QInput:F.A,QSelect:v.A,QCardActions:_.A}),I()(d,"directives",{ClosePopup:y.A})}}]);
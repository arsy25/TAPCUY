"use strict";(globalThis["webpackChunkdo_it"]=globalThis["webpackChunkdo_it"]||[]).push([[433],{433:(e,t,a)=>{a.r(t),a.d(t,{default:()=>x});var l=a(1758),o=a(8790);const s={class:"text-right q-mb-sm"},i={key:0},n={key:1};function d(e,t,a,d,r,c){const m=(0,l.g2)("q-card"),u=(0,l.g2)("q-btn"),b=(0,l.g2)("q-td"),p=(0,l.g2)("q-badge"),g=(0,l.g2)("q-table"),f=(0,l.g2)("q-page"),h=(0,l.g2)("q-card-section"),k=(0,l.g2)("q-input"),_=(0,l.g2)("q-select"),v=(0,l.g2)("q-card-actions"),y=(0,l.g2)("q-dialog"),q=(0,l.g2)("q-icon"),D=(0,l.gN)("close-popup");return(0,l.uX)(),(0,l.CE)(l.FK,null,[t[15]||(t[15]=(0,l.Lk)("link",{rel:"stylesheet",href:"https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css"},null,-1)),(0,l.bF)(f,{class:"q-pa-md bg-white"},{default:(0,l.k6)((()=>[(0,l.Lk)("div",null,[(0,l.bF)(m,{class:"q-pa-md no-shadow q-mb-md cardd",bordered:""},{default:(0,l.k6)((()=>t[9]||(t[9]=[(0,l.Lk)("p",{class:"text-weight-bold texttitle text text-h6 text-black"}," All Devices ",-1),(0,l.Lk)("p",{class:"text-weight-bold text-caption text-grey-5 text"}," View and manage all registered devices from this section. ",-1)]))),_:1}),(0,l.Lk)("div",null,[(0,l.bF)(m,{class:"q-pa-md no-shadow q-mb-md cardd",bordered:""},{default:(0,l.k6)((()=>[(0,l.Lk)("div",s,[(0,l.bF)(u,{label:"Download Excel",class:"bg-primary text-white",flat:"",onClick:c.downloadExcel},null,8,["onClick"])]),(0,l.bF)(g,{title:"Data Absensi",rows:r.absensi,columns:r.columns,"row-key":"id",flat:"",bordered:"",dense:""},{"body-cell-uid_rfid":(0,l.k6)((e=>[(0,l.bF)(b,{props:e},{default:(0,l.k6)((()=>t[10]||(t[10]=[(0,l.eW)(" ***** ")]))),_:2},1032,["props"])])),"body-cell-status":(0,l.k6)((e=>[(0,l.bF)(b,{props:e},{default:(0,l.k6)((()=>[(0,l.bF)(p,{color:"valid"===e.row.status?"green":"red",align:"center",dense:""},{default:(0,l.k6)((()=>[(0,l.eW)((0,o.v_)(e.row.status),1)])),_:2},1032,["color"])])),_:2},1032,["props"])])),"body-cell-masuk":(0,l.k6)((e=>[(0,l.bF)(b,{props:e},{default:(0,l.k6)((()=>[(0,l.eW)((0,o.v_)(c.formatToWIB(e.row.masuk)),1)])),_:2},1032,["props"])])),"body-cell-keluar":(0,l.k6)((e=>[(0,l.bF)(b,{props:e},{default:(0,l.k6)((()=>[e.row.keluar?((0,l.uX)(),(0,l.CE)("span",i,(0,o.v_)(c.formatToWIB(e.row.keluar)),1)):((0,l.uX)(),(0,l.CE)("span",n," belum absen keluar "))])),_:2},1032,["props"])])),"body-cell-created_at":(0,l.k6)((e=>[(0,l.bF)(b,{props:e},{default:(0,l.k6)((()=>[(0,l.eW)((0,o.v_)(c.formatToWIB(e.row.created_at)),1)])),_:2},1032,["props"])])),"body-cell-aksi":(0,l.k6)((t=>[(0,l.bF)(b,{align:"center"},{default:(0,l.k6)((()=>[(0,l.bF)(u,{color:"primary",icon:"edit",dense:"",flat:"",round:"",onClick:a=>e.editAbsensi(t.row)},null,8,["onClick"]),(0,l.bF)(u,{color:"negative",icon:"delete",dense:"",flat:"",round:"",onClick:a=>e.deleteAbsensi(t.row)},null,8,["onClick"])])),_:2},1024)])),_:1},8,["rows","columns"])])),_:1})])])])),_:1}),(0,l.bF)(y,{modelValue:r.editDialog,"onUpdate:modelValue":t[6]||(t[6]=e=>r.editDialog=e)},{default:(0,l.k6)((()=>[(0,l.bF)(m,{style:{"min-width":"400px"}},{default:(0,l.k6)((()=>[(0,l.bF)(h,null,{default:(0,l.k6)((()=>t[11]||(t[11]=[(0,l.Lk)("div",{class:"text-h6"},"Edit Device",-1)]))),_:1}),(0,l.bF)(h,{class:"q-pt-none"},{default:(0,l.k6)((()=>[(0,l.bF)(k,{modelValue:r.form.device_name,"onUpdate:modelValue":t[0]||(t[0]=e=>r.form.device_name=e),label:"Device Name",dense:"",class:"q-mb-sm"},null,8,["modelValue"]),(0,l.bF)(k,{modelValue:r.form.mac_address,"onUpdate:modelValue":t[1]||(t[1]=e=>r.form.mac_address=e),label:"MAC Address",dense:"",class:"q-mb-sm"},null,8,["modelValue"]),(0,l.bF)(_,{modelValue:r.form.type,"onUpdate:modelValue":t[2]||(t[2]=e=>r.form.type=e),label:"Type",options:["monitoring","controlling"],dense:"",class:"q-mb-sm"},null,8,["modelValue"]),(0,l.bF)(k,{modelValue:r.form.mqtt_topic_pub,"onUpdate:modelValue":t[3]||(t[3]=e=>r.form.mqtt_topic_pub=e),label:"MQTT Topic PUB",dense:"",class:"q-mb-sm"},null,8,["modelValue"]),(0,l.bF)(k,{modelValue:r.form.mqtt_topic_sub,"onUpdate:modelValue":t[4]||(t[4]=e=>r.form.mqtt_topic_sub=e),label:"MQTT Topic SUB",dense:"",class:"q-mb-sm"},null,8,["modelValue"]),(0,l.bF)(_,{modelValue:r.form.status,"onUpdate:modelValue":t[5]||(t[5]=e=>r.form.status=e),label:"Status",options:["online","offline"],dense:"",class:"q-mb-sm"},null,8,["modelValue"])])),_:1}),(0,l.bF)(v,{align:"right"},{default:(0,l.k6)((()=>[(0,l.bo)((0,l.bF)(u,{flat:"",label:"Cancel",color:"negative"},null,512),[[D]]),(0,l.bF)(u,{flat:"",label:"Save",color:"primary",onClick:c.updateDevice},null,8,["onClick"])])),_:1})])),_:1})])),_:1},8,["modelValue"]),(0,l.bF)(y,{modelValue:r.confirmDeleteDialog,"onUpdate:modelValue":t[8]||(t[8]=e=>r.confirmDeleteDialog=e)},{default:(0,l.k6)((()=>[(0,l.bF)(m,null,{default:(0,l.k6)((()=>[(0,l.bF)(h,{class:"row items-center q-pb-none"},{default:(0,l.k6)((()=>[(0,l.bF)(q,{name:"warning",color:"red",class:"q-mr-sm"}),t[12]||(t[12]=(0,l.Lk)("span",{class:"text-h6"},"Konfirmasi Hapus",-1))])),_:1}),(0,l.bF)(h,null,{default:(0,l.k6)((()=>[t[13]||(t[13]=(0,l.eW)(" Apakah kamu yakin ingin menghapus device ")),(0,l.Lk)("strong",null,(0,o.v_)(r.selectedDevice?.device_name),1),t[14]||(t[14]=(0,l.eW)("? "))])),_:1}),(0,l.bF)(v,{align:"right"},{default:(0,l.k6)((()=>[(0,l.bo)((0,l.bF)(u,{flat:"",label:"Batal",color:"primary"},null,512),[[D]]),(0,l.bF)(u,{flat:"",label:"Hapus",color:"negative",onClick:t[7]||(t[7]=e=>c.confirmDelete())})])),_:1})])),_:1})])),_:1},8,["modelValue"])],64)}a(310),a(5962);var r=a(2303);const c={components:{},data(){return{loggedInUserId:null,confirmDeleteDialog:!1,selectedDevice:null,form:{device_name:"",mac_address:"",type:"",mqtt_topic_pub:"",mqtt_topic_sub:"",status:""},editDialog:!1,intervalId:null,absensi:[],columns:[{name:"nama",label:"Nama",field:"nama",align:"left",sortable:!0},{name:"uid_rfid",label:"UID RFID",field:"uid_rfid",align:"left",sortable:!0},{name:"nama_device",label:"Nama device",field:"nama_device",align:"left",sortable:!0},{name:"masuk",label:"Masuk",field:"masuk",align:"left",sortable:!0},{name:"keluar",label:"Keluar",field:"keluar",align:"left",sortable:!0},{name:"status",label:"Status",field:"status",align:"left",sortable:!0},{name:"durasi",label:"Durasi",field:"durasi",align:"right",sortable:!1},{name:"created_at",label:"Tanggal",field:"created_at",align:"left",sortable:!0},{name:"device_id",label:"device_id",field:"device_id",align:"center",sortable:!0},{name:"aksi",label:"Aksi",align:"center"}]}},methods:{async fetchAbsen(){this.$q.loadingBar.start();try{const e=localStorage.getItem("token"),t=await this.$api.get("absen",{headers:{Authorization:`Bearer ${e}`}});this.absensi=t.data,console.log(this.absensi)}catch(e){this.$q.notify({type:"negative",message:"Gagal load pengguna"})}finally{this.$q.loadingBar.stop()}},formatToWIB(e){return e.replace(".000Z","").replace("T"," ")},async confirmDelete(){try{const e=localStorage.getItem("token");await this.$axios.delete(`http://localhost:5000/device/${this.selectedDevice.id_device}`,{headers:{Authorization:`Bearer ${e}`}}),this.$q.notify({type:"positive",message:"Device berhasil dihapus!"}),this.devices=this.devices.filter((e=>e.id_device!==this.selectedDevice.id_device)),this.confirmDeleteDialog=!1,this.selectedDevice=null}catch(e){console.error("Error deleting device:",e),this.$q.notify({type:"negative",message:"Gagal menghapus device."})}},editDevice(e){this.form={...e},this.editDialog=!0},deleteDevice(e){this.selectedDevice=e,this.confirmDeleteDialog=!0},async updateDevice(){try{const e=localStorage.getItem("token");await r.A.put(`http://localhost:5000/device/${this.form.id_device}`,{device_name:this.form.device_name,mac_address:this.form.mac_address,type:this.form.type,mqtt_topic_pub:this.form.mqtt_topic_pub,mqtt_topic_sub:this.form.mqtt_topic_sub,status:this.form.status},{headers:{Authorization:`Bearer ${e}`}}),this.$q.notify({type:"positive",message:"Device berhasil diperbarui."}),this.editDialog=!1,this.fetchDevices()}catch(e){console.error("Gagal update device:",e),this.$q.notify({type:"negative",message:"Gagal memperbarui device."})}},async downloadExcel(){try{const e=localStorage.getItem("token"),t=await this.$api.get("/absen/excel",{responseType:"blob",headers:{...e&&{Authorization:`Bearer ${e}`}}}),a=new Blob([t.data],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),l=window.URL.createObjectURL(a),o=document.createElement("a");o.href=l,o.setAttribute("download","absensi.xlsx"),document.body.appendChild(o),o.click(),o.remove(),window.URL.revokeObjectURL(l),this.$q.notify({type:"positive",message:"Download berhasil!"})}catch(e){this.$q.notify({type:"negative",message:"Download gagal!"})}}},mounted(){this.fetchAbsen();const e=JSON.parse(localStorage.getItem("user"));this.loggedInUserId=e?e.id_user:null,this.intervalId=setInterval(this.fetchAbsen,2e3)},computed:{user(){return JSON.parse(localStorage.getItem("user"))||{}}}};var m=a(2807),u=a(7716),b=a(3316),p=a(1693),g=a(528),f=a(5262),h=a(3954),k=a(2156),_=a(4189),v=a(9270),y=a(8005),q=a(2669),D=a(492),w=a(8672),F=a(8582),A=a.n(F);const V=(0,m.A)(c,[["render",d]]),x=V;A()(c,"components",{QPage:u.A,QCard:b.A,QBtn:p.A,QTable:g.A,QTd:f.A,QBadge:h.A,QDialog:k.A,QCardSection:_.A,QInput:v.A,QSelect:y.A,QCardActions:q.A,QIcon:D.A}),A()(c,"directives",{ClosePopup:w.A})}}]);